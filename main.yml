- name: catalogue
  hosts: all
  become: yes
  vars:
    component: catalogue
  tasks:
    - name: nodejs repos
      ansible.builtin.shell: curl -sL https://rpm.nodesource.com/setup_lts.x | bash

    - name: Install nodejs
      ansible.builtin.yum:
        name: nodejs
        state: installed
    - name: download dependencies
      ansible.builtin.shell: npm install
      args:
        chdir: /app

    - name: setup systemd
      ansible.builtin.copy:
        src: "{{component}}.service"
        dest: /etc/systemd/system/{{component}}.service


    - name: start {{component}} service
      ansible.builtin.systemd:
        name: "{{component}}"
        state: restarted
        enabled: yes
        daemon_reload: yes

    - name: copy mongodb
      ansible.builtin.copy:
        src: mongo.repo
        dest: /etc/yum.repos.d/mongo.repo

    - name: install mongodb client
      ansible.builtin.yum:
        name: mongodb-org-shell
        state: installed

    - name: load schema
      ansible.builtin.shell: mongo --host mongodb-dev.poornadevops.online </app/schema/{{component}}.js
